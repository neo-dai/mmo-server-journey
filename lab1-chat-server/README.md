# Lab1: 聊天室服务器开发计划

## 项目概述

这是MMO服务器的"Helloworld"。所有MMO都离不开网络通信和状态广播。

**项目目标**：实现一个支持多房间、支持公屏和私聊的聊天服务器。

**MMO关联技能**：
- **网络编程**：掌握 TCP 或 WebSocket，了解 Socket 编程
- **连接管理**：如何维护一个"在线用户列表"（Connection Pool）
- **消息广播**：如何高效地把一条消息推送给成百上千个连接
- **协议设计**：定义简单的消息格式（例如用JSON或Protobuf）

---

## 版本开发计划

### ✅ 版本 0.1：基础 Echo Server（已完成）
**目标**：建立最基本的客户端-服务器通信，适合新手学习 Socket 编程基础

**功能点**：
- [x] 服务器启动，监听指定端口（如 8080）
- [x] 客户端可以连接到服务器（TCP Socket）
- [x] 客户端发送消息，服务器原样返回（Echo）
- [x] 单客户端连接（简化版本）

**验收标准**：
- ✅ 客户端连接后，发送消息，服务器返回相同内容
- ✅ 单客户端连接正常工作

**技术要点**：
- C++11 标准
- 基础的 Socket 监听和连接处理
- 简单的函数式结构，易于理解

**Tag**: `lab1-v0.1-echo-server`

---

### ✅ 版本 0.2：多用户连接和读写分离（已完成）
**目标**：支持多客户端并发连接，客户端实现读写分离

**功能点**：
- [x] 服务器支持多客户端并发连接（多线程）
- [x] 客户端读写分离（独立线程接收消息）
- [x] 线程安全的日志输出
- [x] 双全工通信支持

**验收标准**：
- ✅ 多个客户端可以同时连接到服务器
- ✅ 客户端可以连续发送消息，无需等待回显
- ✅ 服务器可以同时处理多个客户端请求

**技术要点**：
- 多线程编程（std::thread）
- 线程同步（std::mutex）
- 连接池管理（每个客户端独立线程）

**Tag**: `lab1-v0.2-multi-user`

---

### 📌 版本 0.3：基础聊天室（无状态）
**目标**：实现最简单的多人聊天功能

**功能点**：
- [ ] 客户端连接时设置昵称（name）
- [ ] 服务器维护在线用户列表（内存中）
- [ ] 用户发送消息，广播给所有在线用户
- [ ] 用户上线/下线时，通知其他用户

**消息协议示例**：
```json
// 客户端设置昵称
{"type": "set_name", "name": "Alice"}

// 客户端发送消息
{"type": "chat", "message": "大家好！"}

// 服务器广播消息
{"type": "broadcast", "from": "Alice", "message": "大家好！", "timestamp": 1234567890}

// 用户上线通知
{"type": "user_joined", "name": "Bob"}

// 用户下线通知
{"type": "user_left", "name": "Bob"}
```

**验收标准**：
- 用户A设置昵称后发送消息，用户B和C都能收到
- 用户D上线时，A、B、C收到通知
- 用户A下线时，B、C收到通知

**技术要点**：
- 连接池管理（Connection Pool）
- 消息广播机制
- 简单的状态管理（内存中的用户列表）
- JSON 消息协议

---

### 📌 版本 0.4：分组/频道功能（无状态）
**目标**：支持创建和加入不同的聊天分组

**功能点**：
- [ ] 用户可以创建分组（如 `/create trade`）
- [ ] 用户可以加入分组（如 `/join trade`）
- [ ] 用户可以离开分组（如 `/leave trade`）
- [ ] 用户发送消息时，只发送到当前所在分组
- [ ] 用户可以查看所有可用分组列表
- [ ] 默认有一个"大厅"分组，所有用户自动加入

**消息协议扩展**：
```json
// 创建分组
{"type": "create_group", "group_name": "trade"}

// 加入分组
{"type": "join_group", "group_name": "trade"}

// 离开分组
{"type": "leave_group", "group_name": "trade"}

// 查看分组列表
{"type": "list_groups"}

// 分组消息（只在组内广播）
{"type": "group_message", "group": "trade", "from": "Alice", "message": "卖装备！"}
```

**验收标准**：
- 用户A创建"trade"分组，用户B可以加入
- 用户A在"trade"分组发消息，只有该分组内的用户收到
- 用户C在"大厅"分组发消息，用户A和B（如果不在大厅）收不到
- 用户可以同时加入多个分组

**技术要点**：
- 分组管理（Group Manager）
- 用户-分组的多对多关系
- 消息路由（根据分组过滤接收者）

---

### 📌 版本 0.5：私聊功能
**目标**：支持用户之间的点对点私聊

**功能点**：
- [ ] 用户可以查看在线用户列表
- [ ] 用户可以向指定用户发送私聊消息（如 `/w Bob 你好`）
- [ ] 私聊消息只发送给目标用户
- [ ] 支持私聊历史记录（可选，内存中）

**消息协议扩展**：
```json
// 查看在线用户
{"type": "list_users"}

// 发送私聊
{"type": "whisper", "to": "Bob", "message": "你好"}

// 接收私聊
{"type": "whisper", "from": "Alice", "message": "你好", "timestamp": 1234567890}
```

**验收标准**：
- 用户A向用户B发送私聊，只有B收到
- 用户C看不到A和B的私聊内容
- 可以查看当前所有在线用户

**技术要点**：
- 用户查找（根据昵称）
- 点对点消息路由

---

### 📌 版本 0.6：Web 客户端支持
**目标**：实现 Web 客户端连接支持

**功能点**：
- [ ] 创建 WebSocket 网关服务器
- [ ] Web 客户端通过 WebSocket 连接
- [ ] 网关服务器转发消息到 TCP Echo Server
- [ ] 支持 HTML + JavaScript Web 客户端

**技术要点**：
- WebSocket 协议
- 网关服务器（协议转换）
- 前端开发（HTML/CSS/JavaScript）

---

## 技术栈

- **语言**: C++11
- **网络**: TCP Socket
- **并发**: std::thread, std::mutex
- **构建**: CMake

---

## 开发建议

1. **每个版本独立开发**：完成一个版本并测试通过后，再进入下一个版本
2. **保持代码整洁**：每个版本都要重构，为下一个版本做准备
3. **重视协议设计**：消息协议是核心，设计时要考虑扩展性
4. **先实现功能，再优化性能**：先让功能跑起来，再考虑性能优化
5. **写测试**：至少为关键功能写单元测试

---

## 验收清单

完成所有版本后，你应该能够：

- ✅ 理解 Socket 编程和连接管理
- ✅ 掌握消息广播机制
- ✅ 理解状态管理（内存 vs 持久化）
- ✅ 设计可扩展的消息协议
- ✅ 实现基本的用户系统和关系管理
- ✅ 处理并发和异步操作

---

**当前进度**: v0.2 已完成 ✅

**下一个版本**: v0.3 基础聊天室
