# Chat Client (C++)

一个支持聊天室的 C++ 客户端，用于连接聊天服务器并参与群聊。

## 功能特性

- ✅ TCP Socket 客户端
- ✅ 连接到聊天服务器
- ✅ 交互式消息发送
- ✅ 自动接收广播消息（多线程）
- ✅ 显示用户上线/下线通知
- ✅ 支持自定义服务器地址和端口

## 学习重点

这个版本在 v0.2 基础上增加了聊天室功能：
- 消息广播接收
- 系统通知显示
- 实时群聊体验

## 版本历史

- **v0.1**: 请求-响应模式 Echo Client
- **v0.2**: 读写分离 Echo Client（双全工）
- **v0.3** (当前): 聊天室客户端（消息广播）

## 编译

### 使用 CMake

```bash
mkdir build
cd build
cmake ..
make
```

### 手动编译

```bash
g++ -std=c++11 -pthread -o echo_client echo_client.cpp
```

## 运行

```bash
./echo_client [服务器IP] [端口号]
```

参数说明：
- `服务器IP`：服务器地址，默认为 `127.0.0.1`
- `端口号`：服务器端口，默认为 `8080`

示例：

```bash
# 使用默认地址和端口（127.0.0.1:8080）
./echo_client

# 指定服务器地址
./echo_client 192.168.1.100

# 指定服务器地址和端口
./echo_client 192.168.1.100 3000
```

## 使用方法

1. 启动客户端后，自动连接到服务器
2. 连接后自动加入聊天室（无需设置昵称）
3. 输入消息并按回车发送
4. 所有其他用户会收到你的消息
5. 你会收到其他用户的消息和系统通知
6. 输入 `quit` 或 `exit` 退出客户端

示例会话：

```
=== 聊天室客户端 ===
输入消息发送到聊天室（输入 'quit' 或 'exit' 退出）
========================================
[客户端] 已连接到服务器: 127.0.0.1:8080
[系统] 127.0.0.1:54322 加入了聊天室
Hello everyone!
[127.0.0.1:54321] Hi there!
[127.0.0.1:54322] Hello everyone!
[系统] 127.0.0.1:54321 离开了聊天室
quit
```

## 测试流程

1. **启动服务器**（在另一个终端）：
   ```bash
   cd ../server/build
   ./echo_server
   ```

2. **启动多个客户端**（在不同终端）：
   ```bash
   cd ../client/build
   ./echo_client
   ```

3. **测试聊天功能**：
   - 在客户端1输入消息
   - 观察客户端2和客户端3是否收到
   - 测试用户上线/下线通知

## 架构说明

- **多线程模型**：使用独立线程接收服务器消息，主线程处理用户输入
- **读写分离**：发送和接收操作可以同时进行
- **线程安全**：使用 `std::mutex` 保护日志输出
- **自动加入**：连接后自动加入聊天室，无需额外操作

## 消息显示

客户端会显示两种类型的消息：

1. **用户消息**：其他用户发送的聊天消息
   ```
   [127.0.0.1:54321] Hello everyone!
   ```

2. **系统通知**：用户上线/下线通知
   ```
   [系统] 127.0.0.1:54322 加入了聊天室
   [系统] 127.0.0.1:54321 离开了聊天室
   ```

## 代码结构

- `ChatClient` 类：封装客户端逻辑
- `receive_messages()` 方法：在独立线程中接收服务器消息
- 主线程：处理用户输入和消息发送

## 与 v0.2 的区别

| 特性 | v0.2 | v0.3 |
|------|------|------|
| 功能 | Echo（回显） | 聊天室（广播） |
| 消息来源 | 自己的回显 | 其他用户的消息 |
| 系统通知 | 无 | 有（上线/下线） |
| 用户体验 | 测试工具 | 聊天应用 |

## 下一步

- [ ] 添加 JSON 消息协议支持
- [ ] 实现消息历史记录
- [ ] 添加连接重试机制
- [ ] 支持命令行模式（非交互式）
