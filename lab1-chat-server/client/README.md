# Echo Client (C++)

一个支持读写分离的 C++ Echo 客户端，用于连接 Echo 服务器并测试 Echo 功能。

## 功能特性

- ✅ TCP Socket 客户端
- ✅ 连接到 Echo 服务器
- ✅ 交互式消息发送
- ✅ 读写分离：独立线程接收服务器消息（双全工通信）
- ✅ 支持自定义服务器地址和端口
- ✅ 线程安全的日志输出

## 学习重点

这个版本在 v0.1 基础上增加了多线程支持：
- Socket 创建和配置
- 连接到服务器
- 多线程编程（读写分离）
- 线程同步（mutex 保护共享资源）
- 双全工通信：发送和接收可以同时进行

## 版本历史

- **v0.1**: 请求-响应模式，适合学习 Socket 编程基础
- **v0.2** (当前): 读写分离模式，支持双全工通信

## 编译

### 使用 CMake

```bash
mkdir build
cd build
cmake ..
make
```

### 手动编译

```bash
g++ -std=c++11 -pthread -o echo_client echo_client.cpp
```

## 运行

```bash
./echo_client [服务器IP] [端口号]
```

参数说明：
- `服务器IP`：服务器地址，默认为 `127.0.0.1`
- `端口号`：服务器端口，默认为 `8080`

示例：

```bash
# 使用默认地址和端口（127.0.0.1:8080）
./echo_client

# 指定服务器地址
./echo_client 192.168.1.100

# 指定服务器地址和端口
./echo_client 192.168.1.100 3000
```

## 使用方法

1. 启动客户端后，连接到服务器
2. 输入消息并按回车发送
3. 服务器回显会自动在后台接收并显示（无需等待）
4. 可以连续发送多条消息
5. 输入 `quit` 或 `exit` 退出客户端

示例会话：

```
=== Echo Client ===
输入消息发送到服务器（输入 'quit' 或 'exit' 退出）
========================================
[客户端] 已连接到服务器: 127.0.0.1:8080
Hello, Server!
[客户端] 已发送: Hello, Server!
[客户端] 收到回显: Hello, Server!
This is message 1
[客户端] 已发送: This is message 1
Another message
[客户端] 已发送: Another message
[客户端] 收到回显: This is message 1
[客户端] 收到回显: Another message
quit
[客户端] 已断开连接
```

## 测试流程

1. **启动服务器**（在另一个终端）：
   ```bash
   cd ../server/build
   ./echo_server
   ```

2. **启动客户端**：
   ```bash
   cd ../client/build
   ./echo_client
   ```

3. **发送消息测试**：
   - 在客户端输入任意消息
   - 观察服务器和客户端的日志输出
   - 验证消息是否正确回显
   - 尝试快速连续发送多条消息，验证读写分离效果

## 架构说明

- **多线程模型**：使用独立线程接收服务器消息，主线程处理用户输入
- **读写分离**：发送和接收操作可以同时进行，互不阻塞
- **线程安全**：使用 `std::mutex` 保护日志输出
- **资源管理**：使用 RAII 原则管理 socket 资源

## 代码结构

代码采用面向对象设计：
- `EchoClient` 类：封装客户端逻辑
- `receive_messages()` 方法：在独立线程中接收服务器消息
- 主线程：处理用户输入和消息发送

## 与 v0.1 的区别

| 特性 | v0.1 | v0.2 |
|------|------|------|
| 通信模式 | 请求-响应 | 双全工 |
| 线程模型 | 单线程 | 多线程 |
| 发送后 | 必须等待接收 | 可以继续发送 |
| 适用场景 | 学习基础 | 实际应用 |

## 下一步

- [ ] 添加 JSON 消息协议支持
- [ ] 实现消息历史记录
- [ ] 添加连接重试机制
- [ ] 支持命令行模式（非交互式）
- [ ] 性能优化（消息队列、缓冲区等）
